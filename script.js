// Language translations
const translations = {
  en: {
    // Navigation
    "nav-about": "About",
    "nav-skills": "Skills",
    "nav-portfolio": "Portfolio",
    "nav-experience": "Experience",

    // Hero section
    "hero-im": "I'M",
    "hero-title": "Backend Developer",

    // About section
    "about-title": "About",
    "about-description":
      "Backend Developer with 3+ years of experience building software used by teams of 50+ people, increasing operational efficiency by up to 90%.",

    // Skills section
    "skills-title": "My Skills",
    "angular-experience": "2 years of experience.",
    "react-experience": "1 year of experience.",
    "spring-experience": "1.5 years of experience",
    "nestjs-experience": "1 year of experience.",
    "java-experience": "2 years of experience",
    "devops-experience": "1 year of experience",
    "mysql-experience": "1.5 year of experience",
    "html-experience": "2.5 years of experience",
    "php-experience": "1 year of experience.",
    "github-experience": "2.5 year of experience.",

    // Projects section
    "projects-title": "Projects",
    "project1-title": "Fruit Distribution & Management Platform",
    "project1-description":
      "Streamlines business operations with secure JWT authentication, executive dashboard with real-time analytics, and comprehensive CRUD operations. Integrated with Argentine tax authorities (ARCA & ARBA) for automated compliance. Built with Spring Boot, Angular, PostgreSQL, nginx, and Docker for scalable enterprise deployment.",

    "project2-title": "Management System",
    "project2-description":
      "Designed an ERP system capable of automating tasks, achieving a 90% improvement in efficiency. Developed with an efficiency-driven approach, leveraging web scraping tools and custom-built solutions.",
    "project3-title": "Chicken Time",
    "project3-description":
      "Simple game made with LibGDX to explore physics engines and game design with an actual library.",
    "project4-title": "C-Tor Wars",
    "project4-description":
      "C-tor Wars is a game made completly with C. Project made in group with libraries that we made. It was a 2 player game that allowed you to make your own army with custom stats that fought another army that your friend made. With a graphic interface made also by us.",
    "project5-title": "NewFav",
    "project5-description":
      "NewFav was a recommendation platform that allowed the user to make custom playlists and be recommended by the system new songs. Made connecting with the Spotify API.",
    "project6-title": "Management System",
    "project6-description":
      "Management System was a project made in group with C. It was a simple management system that allowed the user to manage the products and the sales. Made with a simple graphic interface made by us.",

    // Experience section
    "experience-title": "Experience",
    "exp1-title": "Fullstack Developer",
    "exp1-company": "Freelance",
    "exp1-description":
      "Designed an ERP system capable of automating tasks, achieving a 90% improvement in efficiency. Developed with an efficiency-driven approach, leveraging web scraping tools and custom-built solutions.",
    "exp2-title": "Fullstack Developer",
    "exp2-company": "Freelance",
    "exp2-description":
      "Developed a comprehensive ERP system for a fruit distribution company, implementing a backend solution with modern technologies. It has sales, inventory, logistics, customer, supplier, employee, financial and analytics management modules.",
    "exp3-title": "Fullstack Developer",
    "exp3-company": "Universidad Tecnológica Nacional de Mar del Plata",
    "exp3-description":
      "Angular-based website with CRUD functionality for lists and users, a database, and integration with the Spotify API. The page recommends songs to users who have created accounts and allows them to save these songs in lists.",
    "exp4-title": "System Analyst and IT support",
    "exp4-company": "Grupo Merito – Rio Uruguay Seguros",
    "exp4-description":
      "My daily duties revolve around troubleshooting both hardware and software issues. I take the lead in exploring and innovating across the entire technological landscape within the company. This involves implementing system changes, researching new programs, and finding solutions to enhance productivity, efficiency, and overall workflow.",
    "exp5-title": "PHP Developer",
    "exp5-company": "Freelance",
    "exp5-description":
      "As a freelancer, I undertook a project to create a personalized and custom-designed website based on the client's specifications. The backend was meticulously crafted using PHP and MySQL, equipped with versatile CRUD functionalities for both products and users, among other tailored features as per the client's requests. On the front end, I employed a dynamic combination of HTML, CSS, and Bootstrap to ensure an aesthetically pleasing and responsive user-friendly interface.",
    "exp6-title": "Data scientist and IT support",
    "exp6-company": "Rossi Rossi - Express",
    "exp6-description":
      "My daily responsibilities involved crafting and designing reports using MySQL and Microsoft Access, utilizing data extracted from various applications used by employees across the entire company. These reports served as valuable tools for department heads, aiding in informed decision-making. The other facet of my role encompassed providing technical support for the company's hardware, which included computers and networks at large. Additionally, I served as the go-to helpdesk resource for the diverse array of applications employed by over 15 stores and multiple warehouses.",
  },
  es: {
    // Navigation
    "nav-about": "Acerca de",
    "nav-skills": "Habilidades",
    "nav-portfolio": "Portafolio",
    "nav-experience": "Experiencia",

    // Hero section
    "hero-im": "SOY",
    "hero-title": "Desarrollador Backend",

    // About section
    "about-title": "Acerca de",
    "about-description":
      "Desarrollador Backend con 3+ años de experiencia creando programas usados por equipos de 50+ personas, mejorando su efficiencia hasta un 90%.",

    // Skills section
    "skills-title": "Habilidades",
    "angular-experience": "2 años de experiencia.",
    "react-experience": "1 año de experiencia.",
    "spring-experience": "1.5 años de experiencia",
    "nestjs-experience": "1 año de experiencia.",
    "java-experience": "2 años de experiencia",
    "devops-experience": "1 año de experiencia",
    "mysql-experience": "1.5 años de experiencia",
    "html-experience": "2.5 años de experiencia",
    "php-experience": "1 año de experiencia.",
    "github-experience": "2.5 años de experiencia.",

    // Projects section
    "projects-title": "Proyectos",

    "project1-title": "Plataforma de Distribución y Gestión de Frutas",
    "project1-description":
      "Optimiza las operaciones comerciales con autenticación JWT segura, panel ejecutivo con análisis en tiempo real y operaciones CRUD integrales. Integrado con las autoridades fiscales argentinas (ARCA & ARBA) para cumplimiento automatizado. Construido con Spring Boot, Angular, PostgreSQL, nginx y Docker para implementación empresarial escalable.",
    "project2-title": "Sistema de Gestión",
    "project2-description":
      "Diseñé un ERP capaz de automatizar tareas logrando una mejora de eficiencia de un 90%. Desarrollado con una visión enfocada en la eficiencia, empleando herramientas de scraping y otras personalizadas.",

    "project3-title": "Chicken Time",
    "project3-description":
      "Juego simple hecho con LibGDX para explorar motores de física y diseño de juegos con una biblioteca real.",
    "project4-title": "C-Tor Wars",
    "project4-description":
      "C-tor Wars es un juego hecho completamente con C. Proyecto realizado en grupo con bibliotecas que hicimos nosotros. Era un juego para 2 jugadores que te permitía crear tu propio ejército con estadísticas personalizadas que luchaba contra otro ejército que hizo tu amigo. Con una interfaz gráfica también hecha por nosotros.",
    "project5-title": "NewFav",
    "project5-description":
      "NewFav era una plataforma de recomendaciones que permitía al usuario crear listas de reproducción personalizadas y recibir recomendaciones del sistema de nuevas canciones. Hecho conectando con la API de Spotify.",
    "project6-title": "Sistema de Gestión",
    "project6-description":
      "Sistema de Gestión fue un proyecto realizado en grupo con C. Era un sistema de gestión simple que permitía al usuario gestionar los productos y las ventas. Hecho con una interfaz gráfica simple hecha por nosotros.",

    // Experience section
    "experience-title": "Experiencia",
    "exp1-title": "Desarrollador Full Stack",
    "exp1-company": "Freelance",
    "exp1-description":
      "Diseñé un ERP capaz de automatizar tareas logrando una mejora de eficiencia de un 90%. Desarrollado con una visión enfocada en la eficiencia, empleando herramientas de scraping y otras personalizadas.",
    "exp2-title": "Desarrollador Full Stack",
    "exp2-company": "Freelance",
    "exp2-description":
      "Desarrollé un sistema ERP integral para una empresa de distribución de frutas, implementando una solución full-stack con tecnologías modernas. Tiene módulos de gestión de ventas, inventario, logística, clientes, proveedores, empleados, financiero y análisis.",
    "exp3-title": "Desarrollador Angular",
    "exp3-company": "Universidad Tecnológica Nacional de Mar del Plata",
    "exp3-description":
      "Sitio web basado en Angular con funcionalidad CRUD para listas y usuarios, una base de datos e integración con la API de Spotify. La página recomienda canciones a usuarios que han creado cuentas y les permite guardar estas canciones en listas.",
    "exp4-title": "Analista de Sistemas y Soporte IT",
    "exp4-company": "Grupo Merito – Rio Uruguay Seguros",
    "exp4-description":
      "Mis tareas diarias giran en torno a la resolución de problemas tanto de hardware como de software. Lidero la exploración e innovación en todo el panorama tecnológico dentro de la empresa. Esto implica implementar cambios en el sistema, investigar nuevos programas y encontrar soluciones para mejorar la productividad, eficiencia y flujo de trabajo general.",
    "exp5-title": "Desarrollador PHP",
    "exp5-company": "Freelance",
    "exp5-description":
      "Como freelancer, emprendí un proyecto para crear un sitio web personalizado y diseñado a medida basado en las especificaciones del cliente. El backend fue meticulosamente elaborado usando PHP y MySQL, equipado con funcionalidades CRUD versátiles para productos y usuarios, entre otras características personalizadas según las solicitudes del cliente. En el frontend, empleé una combinación dinámica de HTML, CSS y Bootstrap para asegurar una interfaz amigable al usuario estéticamente agradable y responsiva.",
    "exp6-title": "Científico de Datos y Soporte IT",
    "exp6-company": "Rossi Rossi - Express",
    "exp6-description":
      "Mis responsabilidades diarias involucraban crear y diseñar informes usando MySQL y Microsoft Access, utilizando datos extraídos de varias aplicaciones usadas por empleados en toda la empresa. Estos informes sirvieron como herramientas valiosas para los jefes de departamento, ayudando en la toma de decisiones informadas. La otra faceta de mi rol abarcaba proporcionar soporte técnico para el hardware de la empresa, que incluía computadoras y redes en general. Además, serví como el recurso de mesa de ayuda para la diversa gama de aplicaciones empleadas por más de 15 tiendas y múltiples almacenes.",
  },
};

class LanguageManager {
  constructor() {
    this.currentLanguage =
      this.getStoredLanguage() || this.detectUserLanguage();
    this.init();
  }

  init() {
    this.updateLanguage(this.currentLanguage);
    this.addEventListeners();
    this.updateActiveFlag();
  }

  getStoredLanguage() {
    return localStorage.getItem("preferred-language");
  }

  setStoredLanguage(lang) {
    localStorage.setItem("preferred-language", lang);
  }

  detectUserLanguage() {
    // Method 1: Check browser language preference (most reliable)
    const browserLanguage = navigator.language || navigator.userLanguage;

    if (browserLanguage) {
      // Extract the language code (e.g., 'es-AR' -> 'es', 'en-US' -> 'en')
      const langCode = browserLanguage.toLowerCase().split("-")[0];

      // Check if we support this language
      if (langCode === "es" || langCode === "en") {
        console.log(`Language detected from browser: ${langCode}`);
        return langCode;
      }
    }

    // Method 2: Fallback to timezone detection
    try {
      const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
      console.log(`User timezone: ${timezone}`);

      // Map common Spanish-speaking countries' timezones to Spanish
      const spanishTimezones = [
        "America/Argentina/Buenos_Aires",
        "America/Argentina/Cordoba",
        "America/Argentina/Mendoza",
        "America/Mexico_City",
        "America/Bogota",
        "America/Lima",
        "America/Santiago",
        "Europe/Madrid",
        "America/Caracas",
        "America/La_Paz",
        "America/Asuncion",
        "America/Montevideo",
        "America/Guatemala",
        "America/Tegucigalpa",
        "America/Managua",
        "America/Costa_Rica",
        "America/Panama",
        "America/Havana",
        "America/Santo_Domingo",
        "Atlantic/Canary",
      ];

      if (
        spanishTimezones.some(
          (tz) => timezone.includes(tz.split("/")[1]) || timezone === tz
        )
      ) {
        console.log(`Spanish language detected from timezone: ${timezone}`);
        return "es";
      }
    } catch (error) {
      console.warn("Could not detect timezone:", error);
    }

    // Method 3: Optional IP-based geolocation (async fallback)
    // This runs asynchronously and updates language if different from default
    this.detectLanguageByLocation();

    // Default fallback
    return "en";
  }

  async detectLanguageByLocation() {
    try {
      // Use a free IP geolocation service
      const response = await fetch("https://ipapi.co/json/");
      const data = await response.json();

      if (data.country_code) {
        console.log(`User country detected: ${data.country_code}`);

        // Map Spanish-speaking countries to Spanish
        const spanishCountries = [
          "AR",
          "MX",
          "ES",
          "CO",
          "PE",
          "VE",
          "CL",
          "EC",
          "GT",
          "CU",
          "BO",
          "DO",
          "HN",
          "PY",
          "SV",
          "NI",
          "CR",
          "PA",
          "UY",
          "GQ",
        ];

        if (spanishCountries.includes(data.country_code)) {
          // Only switch if no stored preference and current is default
          if (!this.getStoredLanguage() && this.currentLanguage === "en") {
            console.log(
              `Switching to Spanish based on country: ${data.country_code}`
            );
            this.switchLanguage("es");
          }
        }
      }
    } catch (error) {
      // Silently fail - geolocation is optional
      console.warn("IP-based location detection failed:", error);
    }
  }

  addEventListeners() {
    const languageToggles = document.querySelectorAll(".language-toggle");
    languageToggles.forEach((toggle) => {
      toggle.addEventListener("click", (e) => {
        const selectedLang = e.currentTarget.dataset.lang;
        if (selectedLang !== this.currentLanguage) {
          this.switchLanguage(selectedLang);
        }
      });

      // Add cursor pointer style
      toggle.style.cursor = "pointer";
    });
  }

  switchLanguage(newLang) {
    this.currentLanguage = newLang;
    this.setStoredLanguage(newLang);
    this.updateLanguage(newLang);
    this.updateActiveFlag();

    // Update document language attribute
    document.documentElement.lang = newLang;
  }

  updateLanguage(lang) {
    const elementsToTranslate = document.querySelectorAll("[data-lang]");

    elementsToTranslate.forEach((element) => {
      const key = element.dataset.lang;
      if (translations[lang] && translations[lang][key]) {
        element.textContent = translations[lang][key];
      }
    });
  }

  updateActiveFlag() {
    const flags = document.querySelectorAll(".language-toggle");
    flags.forEach((flag) => {
      flag.classList.remove("active-language");
      if (flag.dataset.lang === this.currentLanguage) {
        flag.classList.add("active-language");
      }
    });
  }
}

// Initialize language manager when DOM is loaded
document.addEventListener("DOMContentLoaded", () => {
  new LanguageManager();
});

new Swiper(".project-images-list", {
  spaceBetween: 30,
  loop: true,
  slidesPerView: 1,

  autoplay: {
    delay: 4000,
    disableOnInteraction: false,
  },
  breakpoints: {
    0: {
      slidesPerView: 1,
    },
    768: {
      slidesPerView: 1,
    },
    1024: {
      slidesPerView: 1,
    },
  },
});

new Swiper(".project-list", {
  spaceBetween: 30,
  slidesPerView: 3,
  loop: true,

  autoplay: {
    delay: 8000,
    disableOnInteraction: false,
  },
  pagination: {
    el: ".project-pagination",
    clickable: true,
  },

  breakpoints: {
    0: {
      slidesPerView: 1,
    },
    768: {
      slidesPerView: 2,
    },
    1024: {
      slidesPerView: 3,
    },
  },
});
